<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ben tossell</title>
    <meta name="description" content="ben tossell's personal terminal - type 'help' to get started">
    <link rel="icon" type="image/png" href="assets/images/favicon.png">
    <link rel="apple-touch-icon" href="assets/images/apple-touch-icon.png">
    <meta property="og:title" content="ben tossell">
    <meta property="og:description" content="Interactive CLI-style personal website">
    <meta property="og:image" content="assets/images/card.jpg">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="theme-midnight">
    <div class="terminal-wrapper">
        <div class="terminal" id="terminal">
            <div class="terminal-title">
                <div class="title-buttons">
                    <span class="title-btn close"></span>
                    <span class="title-btn minimize"></span>
                    <span class="title-btn maximize"></span>
                </div>
                <span class="title-text">ben@tossell ~ bash</span>
                <div class="title-actions">
                    <button class="help-btn" id="help-btn" aria-label="Show help">?</button>
                </div>
            </div>
            <div class="terminal-body" id="terminal-body">
                <div id="output" role="log" aria-live="polite"></div>
            </div>
            <div class="terminal-input">
                <span class="input-prompt">$</span>
                <form id="command-form" autocomplete="off">
                    <input 
                        type="text" 
                        id="command-input" 
                        placeholder="type a command..."
                        aria-label="Command input"
                        spellcheck="false"
                        autocapitalize="none"
                        autocorrect="off"
                    >
                </form>
            </div>
        </div>
        
        <div class="theme-switcher">
            <button class="theme-btn active" data-theme="midnight">midnight</button>
            <button class="theme-btn" data-theme="phosphor">phosphor</button>
            <button class="theme-btn" data-theme="amber">amber</button>
            <button class="theme-btn" data-theme="matrix">matrix</button>
            <button class="theme-btn" data-theme="contrast">contrast</button>
        </div>
    </div>

    <div id="music-player" class="music-player" aria-live="polite" aria-label="Retro soundtrack music player">
        <div class="music-meta">
            <span class="music-label">arcade radio</span>
            <span id="music-title" class="music-title">select a track</span>
        </div>
        <div class="music-controls" role="group" aria-label="Music controls">
            <button type="button" id="music-prev" class="music-btn" aria-label="Previous track">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="19 20 9 12 19 4 19 20"></polygon>
                    <line x1="5" y1="19" x2="5" y2="5"></line>
                </svg>
            </button>
            <button type="button" id="music-toggle" class="music-btn" aria-label="Play or pause">
                <svg class="icon icon-play" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <svg class="icon icon-pause" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>
                </svg>
            </button>
            <button type="button" id="music-next" class="music-btn" aria-label="Next track">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="5 4 15 12 5 20 5 4"></polygon>
                    <line x1="19" y1="5" x2="19" y2="19"></line>
                </svg>
            </button>
        </div>
    </div>

    <script src="assets/js/terminal.js"></script>
    <script>
    (function() {
        const playerContainer = document.getElementById('music-player');
        const titleEl = document.getElementById('music-title');
        const playToggle = document.getElementById('music-toggle');
        const nextBtn = document.getElementById('music-next');
        const prevBtn = document.getElementById('music-prev');

        const noteFreq = {
            'C2': 65.41, 'D2': 73.42, 'E2': 82.41, 'F2': 87.31, 'G2': 98.00, 'A2': 110.00, 'B2': 123.47,
            'C3': 130.81, 'D3': 146.83, 'E3': 164.81, 'F3': 174.61, 'G3': 196.00, 'A3': 220.00, 'B3': 246.94,
            'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23, 'G4': 392.00, 'A4': 440.00, 'B4': 493.88,
            'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'G5': 783.99, 'A5': 880.00, 'B5': 987.77,
            'C6': 1046.50
        };

        const tracks = [
            {
                title: 'Tetris Theme',
                bpm: 140,
                wave: 'square',
                notes: [
                    'E4', 'B3', 'C4', 'D4', 'C4', 'B3', 'A3', '-', 'A3', 'C4', 'E4', 'D4', 'C4', 'B3', '-',
                    'C4', 'D4', 'E4', 'C4', 'A3', 'A3', '-', '-'
                ]
            },
            {
                title: 'Mario Theme',
                bpm: 180,
                wave: 'square',
                notes: [
                    'E4', 'E4', '-', 'E4', '-', 'C4', 'E4', '-', 'G4', '-', '-', '-', 'G3', '-', '-', '-'
                ]
            },
            {
                title: 'Zelda Lullaby',
                bpm: 90,
                wave: 'triangle',
                notes: [
                    'B4', 'D5', 'A4', '-', 'G4', 'A4', '-', 'B4', 'D5', 'A4', '-', '-', '-', '-', '-', '-'
                ]
            },
            {
                title: 'Pac-Man',
                bpm: 160,
                wave: 'sine',
                notes: [
                    'B4', 'B5', 'F5', 'D5', 'B5', 'F5', 'D5', '-', 'C5', 'C6', 'G5', 'E5', 'C6', 'G5', 'E5', '-'
                ]
            },
            {
                title: 'Space Invaders',
                bpm: 120,
                wave: 'sawtooth',
                notes: [
                    'E3', '-', 'D3', '-', 'E3', '-', 'D3', '-', 'C3', '-', 'D3', '-', 'E3', '-', '-', '-'
                ]
            }
        ];

        let audioContext = null;
        let currentIndex = 0;
        let isPlaying = false;
        let scheduledNotes = [];
        let nextNoteTime = 0;
        let currentNote = 0;
        let timerID = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function playNote(freq, time, duration, waveType) {
            const ctx = initAudio();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            const filter = ctx.createBiquadFilter();

            osc.type = waveType;
            osc.frequency.setValueAtTime(freq, time);

            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(2000, time);
            filter.Q.setValueAtTime(1, time);

            const volume = 0.08;
            const attack = 0.01;
            const decay = 0.05;
            const sustain = 0.6;
            const release = 0.1;

            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(volume, time + attack);
            gain.gain.linearRampToValueAtTime(volume * sustain, time + attack + decay);
            gain.gain.setValueAtTime(volume * sustain, time + duration - release);
            gain.gain.linearRampToValueAtTime(0, time + duration);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);

            osc.start(time);
            osc.stop(time + duration + 0.1);

            scheduledNotes.push({ osc, gain });
        }

        function scheduleNote() {
            const track = tracks[currentIndex];
            const secondsPerBeat = 60.0 / track.bpm;
            const noteDuration = secondsPerBeat * 0.8;

            while (nextNoteTime < audioContext.currentTime + 0.1) {
                const note = track.notes[currentNote];
                if (note !== '-' && noteFreq[note]) {
                    playNote(noteFreq[note], nextNoteTime, noteDuration, track.wave);
                }
                nextNoteTime += secondsPerBeat;
                currentNote = (currentNote + 1) % track.notes.length;
            }
        }

        function scheduler() {
            if (!isPlaying) return;
            scheduleNote();
            timerID = setTimeout(scheduler, 25);
        }

        function startPlayback() {
            if (isPlaying) return;
            initAudio();
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            isPlaying = true;
            currentNote = 0;
            nextNoteTime = audioContext.currentTime;
            scheduler();
            updateUI();
        }

        function stopPlayback() {
            isPlaying = false;
            if (timerID) {
                clearTimeout(timerID);
                timerID = null;
            }
            scheduledNotes.forEach(n => {
                try {
                    n.osc.stop();
                    n.osc.disconnect();
                    n.gain.disconnect();
                } catch(e) {}
            });
            scheduledNotes = [];
            updateUI();
        }

        function updateUI() {
            titleEl.textContent = tracks[currentIndex].title;
            playToggle.classList.toggle('playing', isPlaying);
        }

        function nextTrack() {
            const wasPlaying = isPlaying;
            stopPlayback();
            currentIndex = (currentIndex + 1) % tracks.length;
            updateUI();
            if (wasPlaying) startPlayback();
        }

        function prevTrack() {
            const wasPlaying = isPlaying;
            stopPlayback();
            currentIndex = (currentIndex - 1 + tracks.length) % tracks.length;
            updateUI();
            if (wasPlaying) startPlayback();
        }

        playToggle.addEventListener('click', () => {
            if (isPlaying) stopPlayback();
            else startPlayback();
        });

        nextBtn.addEventListener('click', nextTrack);
        prevBtn.addEventListener('click', prevTrack);

        updateUI();
    })();
    </script>
</body>
</html>
